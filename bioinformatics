# Pre-processing of raw metagenomic data

We have a total of 69 samples.  
Most of them were sequenced only with Illumina NextSeq/NovaSeq; two samples were also sequenced with Nanopore MinION.

## Illumina data

The 69 samples were sequenced using a mix of Illumina NextSeq and NovaSeq, with some samples being sequenced with both.  
That is why we have a total of 88 paired FASTQ files.  
After quality control, we will merge the files from the same sample.

### Download raw data from ENA

```bash
mkdir RAW_ILLUMINA

while read SAMPLE RUN R1_FTP_PATH R2_FTP_PATH; do
  curl $R1_FTP_PATH > RAW_ILLUMINA/$SAMPLE.$RUN.R1.fastq.gz
  curl $R2_FTP_PATH > RAW_ILLUMINA/$SAMPLE.$RUN.R2.fastq.gz
done < <(cut -f 1-4 sample_metadata.tsv | sed '1d')
```

### Check raw data with fastQC and multiQC

```bash
mkdir RAW_ILLUMINA/FASTQC

fastqc RAW_ILLUMINA/*.fastq.gz \
       --outdir RAW_ILLUMINA/FASTQC \
       --threads $NTHREADS

multiqc RAW_ILLUMINA/FASTQC \
        --outdir RAW_ILLUMINA/MULTIQC \
        --interactive
```

### Trim adaptors and do quality filtering with Cutadapt

```bash
mkdir TRIMMED_ILLUMINA

while read SAMPLE RUN; do
  cutadapt RAW_ILLUMINA/$SAMPLE.$RUN.R1.fastq.gz \
           RAW_ILLUMINA/$SAMPLE.$RUN.R2.fastq.gz \
           -o TRIMMED_ILLUMINA/$SAMPLE.$RUN.R1.fastq \
           -p TRIMMED_ILLUMINA/$SAMPLE.$RUN.R2.fastq \
           -a CTGTCTCTTATACACATCTCCGAGCCCACGAGAC \
           -A CTGTCTCTTATACACATCTGACGCTGCCGACGA \
           -m 50 \
           -j $NTHREADS \
           --nextseq-trim 20
done < <(cut -f 1-2 sample_metadata.tsv | sed '1d')
```
